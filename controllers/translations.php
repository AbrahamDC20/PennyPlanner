<?php
if (session_status() === PHP_SESSION_NONE) {
    session_start(); // Start session only if not already started
}

$translations = [
    'es' => [
        'welcome' => 'Bienvenido a Budget Buddy',
        'select_option' => 'Selecciona una opción del menú para comenzar:',
        'home' => 'Inicio',
        'profile' => 'Perfil',
        'transactions' => 'Gestiones',
        'settings' => 'Configuración',
        'theme' => 'Tema',
        'light' => 'Claro',
        'dark' => 'Oscuro',
        'logout' => 'Cerrar Sesión',
        // ...otras traducciones...
        'all_rights_reserved' => 'Todos los derechos reservados',
        'invalid_credentials' => 'Usuario o contraseña incorrectos.',
        'register' => 'Registrarse',
        'login' => 'Iniciar sesión',
        'username' => 'Nombre de usuario',
        'password' => 'Contraseña',
        'both_fields_required' => 'Ambos campos son obligatorios.',
        'help' => 'Ayuda',
        'statistics' => 'Estadísticas',
        'tutorial' => 'Tutorial',
        'reset_password' => 'Restablecer contraseña',
        'email' => 'Correo electrónico',
        'submit' => 'Enviar',
        'phone' => 'Teléfono',
        'ai_response_mode' => 'Modo de respuesta de IA',
        'friendly' => 'Amistoso',
        'formal' => 'Formal',
        'update' => 'Actualizar',
        'add_transaction' => 'Agregar transacción',
        'transaction_history' => 'Historial de transacciones',
        'description' => 'Descripción',
        'amount' => 'Cantidad',
        'friendly_mode_message' => 'Estás en el modo amistoso. ¡Disfruta de una experiencia relajada!',
        'formal_mode_message' => 'Estás en el modo formal. Todo será más profesional.',
        'admin_panel' => 'Panel de Administrador',
        'user_management' => 'Gestión de Usuarios',
        'global_statistics' => 'Estadísticas Globales',
        'total_users' => 'Total de Usuarios',
        'delete' => 'Eliminar',
        'dollars' => 'Dólares',
        'euros' => 'Euros',
        'pounds' => 'Libras',
        'currency_options' => 'Opciones de moneda',
        'select_currency' => 'Seleccionar moneda',
        'dark_mode' => 'Modo oscuro',
        'language' => 'Idioma',
        'spanish' => 'Español',
        'english' => 'Inglés',
        'lithuanian' => 'Lituano',
        'name' => 'Nombre',
        'surname' => 'Apellido',
        'profile_image' => 'Imagen de perfil',
        'username_exists' => 'El nombre de usuario ya existe.',
        'email_exists' => 'El email que intentas usar está registrado.',
        'recover_account' => 'Si deseas recuperar tu cuenta, pulsa aquí',
        'password_changed' => 'La contraseña ha sido cambiada correctamente.',
        'email_not_found' => 'El correo electrónico no está registrado.',
        'email_send_error' => 'No se pudo enviar el correo electrónico. Inténtalo de nuevo más tarde.',
        'click_link' => 'Haz clic en el siguiente enlace para cambiar tu contraseña',
        'confirm_password' => 'Confirmar contraseña',
        'password_mismatch' => 'Las contraseñas no coinciden.',
        'invalid_csrf_token' => 'Token CSRF inválido.',
        'weak' => 'Débil',
        'medium' => 'Media',
        'strong' => 'Fuerte',
        'tutorial_home' => 'Aprende a navegar por la página de inicio.',
        'tutorial_profile' => 'Actualiza la información de tu perfil.',
        'tutorial_transactions' => 'Gestiona tus transacciones fácilmente.',
        'tutorial_settings' => 'Personaliza la configuración de tu aplicación.',
        'start_using_app' => 'Comenzar a usar la aplicación',
        'weak' => 'Contraseña débil. Usa al menos 8 caracteres.',
        'documentation' => 'Documentación',
        'admin_login_only' => 'Las cuentas de administrador solo pueden iniciar sesión desde la página de administrador.',
        'user_login_only' => 'Solo los usuarios pueden iniciar sesión desde esta página.',
    ],
    'en' => [
        'welcome' => 'Welcome to Budget Buddy',
        'select_option' => 'Select an option from the menu to get started:',
        'home' => 'Home',
        'profile' => 'Profile',
        'transactions' => 'Transactions',
        'settings' => 'Settings',
        'theme' => 'Theme',
        'light' => 'Light',
        'dark' => 'Dark',
        'logout' => 'Logout',
        // ...other translations...
        'all_rights_reserved' => 'All rights reserved',
        'invalid_credentials' => 'Invalid username or password.',
        'register' => 'Register',
        'login' => 'Login',
        'username' => 'Username',
        'password' => 'Password',
        'both_fields_required' => 'Both fields are required.',
        'help' => 'Help',
        'statistics' => 'Statistics',
        'tutorial' => 'Tutorial',
        'reset_password' => 'Reset Password',
        'email' => 'Email',
        'submit' => 'Submit',
        'phone' => 'Phone',
        'ai_response_mode' => 'AI Response Mode',
        'friendly' => 'Friendly',
        'formal' => 'Formal',
        'update' => 'Update',
        'add_transaction' => 'Add Transaction',
        'transaction_history' => 'Transaction History',
        'description' => 'Description',
        'amount' => 'Amount',
        'friendly_mode_message' => 'You are in friendly mode. Enjoy a relaxed experience!',
        'formal_mode_message' => 'You are in formal mode. Everything will be more professional.',
        'admin_panel' => 'Admin Panel',
        'user_management' => 'User Management',
        'global_statistics' => 'Global Statistics',
        'total_users' => 'Total Users',
        'delete' => 'Delete',
        'dollars' => 'Dollars',
        'euros' => 'Euros',
        'pounds' => 'Pounds',
        'currency_options' => 'Currency Options',
        'select_currency' => 'Select Currency',
        'dark_mode' => 'Dark Mode',
        'language' => 'Language',
        'spanish' => 'Spanish',
        'english' => 'English',
        'lithuanian' => 'Lithuanian',
        'name' => 'Name',
        'surname' => 'Surname',
        'profile_image' => 'Profile Image',
        'username_exists' => 'The username already exists.',
        'email_exists' => 'The email you are trying to use is already registered.',
        'recover_account' => 'If you want to recover your account, click here',
        'password_changed' => 'The password has been changed successfully.',
        'email_not_found' => 'The email is not registered.',
        'email_send_error' => 'The email could not be sent. Please try again later.',
        'click_link' => 'Click the following link to reset your password',
        'confirm_password' => 'Confirm Password',
        'password_mismatch' => 'Passwords do not match.',
        'invalid_csrf_token' => 'Invalid CSRF token.',
        'weak' => 'Weak',
        'medium' => 'Medium',
        'strong' => 'Strong',
        'tutorial_home' => 'Learn how to navigate the homepage.',
        'tutorial_profile' => 'Update your profile information.',
        'tutorial_transactions' => 'Manage your transactions easily.',
        'tutorial_settings' => 'Customize your app settings.',
        'start_using_app' => 'Start Using the App',
        'weak' => 'Weak password. Use at least 8 characters.',
        'documentation' => 'Documentation',
        'admin_login_only' => 'Admin accounts can only log in from the admin login page.',
        'user_login_only' => 'Only users can log in from this page.',
    ],
    'lt' => [
        'welcome' => 'Sveiki atvykę į Budget Buddy',
        'select_option' => 'Pasirinkite parinktį iš meniu, kad pradėtumėte:',
        'home' => 'Pradžia',
        'profile' => 'Profilis',
        'transactions' => 'Sandoriai',
        'settings' => 'Nustatymai',
        'theme' => 'Tema',
        'light' => 'Šviesus',
        'dark' => 'Tamsus',
        'logout' => 'Atsijungti',
        // ...kiti vertimai...
        'all_rights_reserved' => 'Visos teisės saugomos',
        'invalid_credentials' => 'Neteisingas vartotojo vardas arba slaptažodis.',
        'register' => 'Registruotis',
        'login' => 'Prisijungti',
        'username' => 'Vartotojo vardas',
        'password' => 'Slaptažodis',
        'both_fields_required' => 'Abu laukai yra privalomi.',
        'help' => 'Pagalba',
        'statistics' => 'Statistika',
        'tutorial' => 'Pamoka',
        'reset_password' => 'Slaptažodžio atkūrimas',
        'email' => 'El. paštas',
        'submit' => 'Pateikti',
        'phone' => 'Telefonas',
        'ai_response_mode' => 'AI atsakymo režimas',
        'friendly' => 'Draugiškas',
        'formal' => 'Formalus',
        'update' => 'Atnaujinti',
        'add_transaction' => 'Pridėti operaciją',
        'transaction_history' => 'Operacijų istorija',
        'description' => 'Aprašymas',
        'amount' => 'Suma',
        'friendly_mode_message' => 'Esate draugiškame režime. Mėgaukitės atsipalaidavimu!',
        'formal_mode_message' => 'Esate formaliame režime. Viskas bus profesionalesnė.',
        'admin_panel' => 'Administratoriaus Skydelis',
        'user_management' => 'Vartotojų Valdymas',
        'global_statistics' => 'Pasaulinė Statistika',
        'total_users' => 'Vartotojų Skaičius',
        'delete' => 'Ištrinti',
        'dollars' => 'Dolerių',
        'euros' => 'Eurai',
        'pounds' => 'Svarai',
        'currency_options' => 'Valiutos parinktys',
        'select_currency' => 'Pasirinkti valiutą',
        'dark_mode' => 'Tamsus režimas',
        'language' => 'Kalba',
        'spanish' => 'Ispanų',
        'english' => 'Anglų',
        'lithuanian' => 'Lietuvių',
        'name' => 'Vardas',
        'surname' => 'Pavardė',
        'profile_image' => 'Profilio vaizdas',
        'username_exists' => 'Vartotojo vardas jau egzistuoja.',
        'email_exists' => 'El. paštas, kurį bandote naudoti, jau yra užregistruotas.',
        'recover_account' => 'Jei norite atkurti savo paskyrą, spustelėkite čia',
        'password_changed' => 'Slaptažodis sėkmingai pakeistas.',
        'email_not_found' => 'El. paštas nėra užregistruotas.',
        'email_send_error' => 'El. laiško išsiųsti nepavyko. Bandykite dar kartą vėliau.',
        'click_link' => 'Spustelėkite šią nuorodą, kad pakeistumėte slaptažodį',
        'confirm_password' => 'Patvirtinti slaptažodį',
        'password_mismatch' => 'Slaptažodžiai nesutampa.',
        'invalid_csrf_token' => 'Neteisingas CSRF žetonas.',
        'weak' => 'Silpnas',
        'medium' => 'Vidutinis',
        'strong' => 'Stiprus',
        'tutorial_home' => 'Sužinokite, kaip naršyti pagrindiniame puslapyje.',
        'tutorial_profile' => 'Atnaujinkite savo profilio informaciją.',
        'tutorial_transactions' => 'Lengvai tvarkykite savo operacijas.',
        'tutorial_settings' => 'Pritaikykite programos nustatymus.',
        'start_using_app' => 'Pradėti naudoti programą',
        'weak' => 'Silpnas slaptažodis. Naudokite bent 8 simbolius.',
        'documentation' => 'Dokumentacija',
        'admin_login_only' => 'Administratoriaus paskyros gali prisijungti tik iš administratoriaus prisijungimo puslapio.',
        'user_login_only' => 'Tik vartotojai gali prisijungti iš šio puslapio.',
    ],
    'fr' => [
        'welcome' => 'Bienvenue sur Budget Buddy',
        // ...otras traducciones...
    ],
    'de' => [
        'welcome' => 'Willkommen bei Budget Buddy',
        // ...otras traducciones...
    ],
];

$currentLanguage = $_SESSION['language'] ?? substr($_SERVER['HTTP_ACCEPT_LANGUAGE'], 0, 2);
if (!in_array($currentLanguage, ['es', 'en', 'lt'])) {
    $currentLanguage = 'es'; // Default to Spanish
}

function t($key) {
    global $translations, $currentLanguage;
    return $translations[$currentLanguage][$key] ?? $key;
}